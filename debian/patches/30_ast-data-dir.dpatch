#! /bin/sh /usr/share/dpatch/dpatch-run
## DATA_SOUND_DIRS.dpatch by Jose Carlos Garcia Sogo <jsogo@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad asterisk-1.0.2/astconf.h /tmp/dpep.AARmn3/asterisk-1.0.2/astconf.h
--- asterisk-1.0.2/astconf.h	2003-01-30 16:03:20.000000000 +0100
+++ /tmp/dpep.AARmn3/asterisk-1.0.2/astconf.h	2005-01-04 21:20:00.000000000 +0100
@@ -28,5 +28,6 @@
 extern char ast_config_AST_PID[AST_CONFIG_MAX_PATH];
 extern char ast_config_AST_SOCKET[AST_CONFIG_MAX_PATH];
 extern char ast_config_AST_RUN_DIR[AST_CONFIG_MAX_PATH];
+extern char ast_config_AST_DATA_DIR[AST_CONFIG_MAX_PATH];
 
 #endif
diff -urNad asterisk-1.0.2/asterisk.c /tmp/dpep.AARmn3/asterisk-1.0.2/asterisk.c
--- asterisk-1.0.2/asterisk.c	2004-09-28 19:11:30.000000000 +0200
+++ /tmp/dpep.AARmn3/asterisk-1.0.2/asterisk.c	2005-01-04 21:20:50.000000000 +0100
@@ -124,6 +124,7 @@
 char ast_config_AST_PID[AST_CONFIG_MAX_PATH];
 char ast_config_AST_SOCKET[AST_CONFIG_MAX_PATH];
 char ast_config_AST_RUN_DIR[AST_CONFIG_MAX_PATH];
+char ast_config_AST_DATA_DIR[AST_CONFIG_MAX_PATH];
 
 static char *_argv[256];
 static int shuttingdown = 0;
@@ -1509,7 +1510,8 @@
 	strncpy((char *)ast_config_AST_PID,AST_PID,sizeof(ast_config_AST_PID)-1);
 	strncpy((char *)ast_config_AST_SOCKET,AST_SOCKET,sizeof(ast_config_AST_SOCKET)-1);
 	strncpy((char *)ast_config_AST_RUN_DIR,AST_RUN_DIR,sizeof(ast_config_AST_RUN_DIR)-1);
-	
+	strncpy((char *)ast_config_AST_DATA_DIR,AST_DATA_DIR,sizeof(ast_config_AST_DATA_DIR)-1);
+       
 	/* no asterisk.conf? no problem, use buildtime config! */
 	if (!cfg) {
 		return;
diff -urNad asterisk-1.0.2/asterisk.h /tmp/dpep.AARmn3/asterisk-1.0.2/asterisk.h
--- asterisk-1.0.2/asterisk.h	2004-09-07 17:02:53.000000000 +0200
+++ /tmp/dpep.AARmn3/asterisk-1.0.2/asterisk.h	2005-01-04 21:21:39.000000000 +0100
@@ -24,6 +24,7 @@
 #define AST_MODULE_DIR 	ASTMODDIR
 #define AST_SPOOL_DIR  	ASTSPOOLDIR
 #define AST_VAR_DIR    	ASTVARLIBDIR
+#define AST_DATA_DIR	ASTDATADIR
 #define AST_LOG_DIR	ASTLOGDIR
 #define AST_AGI_DIR	ASTAGIDIR
 #define AST_KEY_DIR	ASTVARLIBDIR "/keys"
@@ -32,8 +33,8 @@
 
 #define AST_CONFIG_FILE ASTCONFPATH
 
-#define AST_SOUNDS AST_VAR_DIR "/sounds"
-#define AST_IMAGES AST_VAR_DIR "/images"
+#define AST_SOUNDS AST_DATA_DIR "/sounds"
+#define AST_IMAGES AST_DATA_DIR "/images"
 
 /* Provided by module.c */
 extern int load_modules(void);
diff -urNad asterisk-1.0.2/file.c /tmp/dpep.AARmn3/asterisk-1.0.2/file.c
--- asterisk-1.0.2/file.c	2004-09-21 01:15:49.000000000 +0200
+++ /tmp/dpep.AARmn3/asterisk-1.0.2/file.c	2005-01-04 21:22:03.000000000 +0100
@@ -284,7 +284,7 @@
 	int fnsize = 0;
 	char tmp[AST_CONFIG_MAX_PATH]="";
 
-	snprintf(tmp, sizeof(tmp), "%s/%s", ast_config_AST_VAR_DIR, "sounds");
+	snprintf(tmp, sizeof(tmp), "%s/%s", ast_config_AST_DATA_DIR, "sounds");
 	fnsize = strlen(tmp) + strlen(filename) + strlen(ext) + 10;
 	fn = malloc(fnsize);
 	if (fn) {
diff -urNad asterisk-1.0.2/image.c /tmp/dpep.AARmn3/asterisk-1.0.2/image.c
--- asterisk-1.0.2/image.c	2004-06-22 20:48:59.000000000 +0200
+++ /tmp/dpep.AARmn3/asterisk-1.0.2/image.c	2005-01-04 21:22:31.000000000 +0100
@@ -95,9 +95,9 @@
 			snprintf(buf, len, "%s.%s", filename, ext);
 	} else {
 		if (preflang && strlen(preflang))
-			snprintf(buf, len, "%s/%s/%s-%s.%s", ast_config_AST_VAR_DIR, "images", filename, preflang, ext);
+			snprintf(buf, len, "%s/%s/%s-%s.%s", ast_config_AST_DATA_DIR, "images", filename, preflang, ext);
 		else
-			snprintf(buf, len, "%s/%s/%s.%s", ast_config_AST_VAR_DIR, "images", filename, ext);
+			snprintf(buf, len, "%s/%s/%s.%s", ast_config_AST_DATA_DIR, "images", filename, ext);
 	}
 }
 
